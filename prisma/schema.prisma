generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id           String            @id @default(cuid())
  telegramId   String            @unique
  username     String?
  firstName    String?
  lastName     String?
  languageCode String?
  lastSeenAt   DateTime          @default(now())
  createdAt    DateTime          @default(now())
  updatedAt    DateTime          @updatedAt

  pools        Pool[]            @relation("UserPools")
  participants PoolParticipant[]
}

model Pool {
  id                       String            @id @default(cuid())
  ownerId                  String
  owner                    User              @relation("UserPools", fields: [ownerId], references: [id], onDelete: Cascade)
  title                    String
  description              String?
  amountType               String            @default("total")
  totalAmount              Float?
  perPersonAmount          Float?
  shareAmount              Float?
  expectedParticipantsCount Int              @default(1)
  paymentDetails           String
  joinCode                 String            @unique
  currency                 String            @default("RUB")
  isClosed                 Boolean           @default(false)
  createdAt                DateTime          @default(now())
  updatedAt                DateTime          @updatedAt

  participants             PoolParticipant[]

  @@index([ownerId])
}

model PoolParticipant {
  id             String            @id @default(cuid())
  poolId         String
  userId         String?
  pool           Pool              @relation(fields: [poolId], references: [id], onDelete: Cascade)
  user           User?             @relation(fields: [userId], references: [id], onDelete: SetNull)
  displayName    String
  status         String            @default("invited")
  paidAmount     Float             @default(0)
  expectedAmount Float             @default(0)
  payMethod      String            @default("unknown")
  note           String?
  joinedAt       DateTime?
  markedAt       DateTime?
  confirmedAt    DateTime?
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt

  @@index([poolId])
  @@index([userId])
  @@unique([poolId, userId])
}

model Session {
  key       String   @id
  data      String   @default("{}")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
